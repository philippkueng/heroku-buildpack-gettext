#!/bin/bash

VERSION="0.19.8"
echo "-----> Install gettext v${VERSION}"

BUILD_DIR=$1
CACHE_DIR="$2/gettext"
INSTALL_PATH=".heroku/gettext"
INSTALL_DIR="$BUILD_DIR/$INSTALL_PATH"

indent() {
    sed -u 's/^/       /'
}

printlog() {
    echo $1 | indent
}

run_silent() {
    $1 > /dev/null 2>&1
}


mkdir -p $CACHE_DIR
printlog "Cache directory: ${CACHE_DIR}"

printlog "Downloading gettext"
wget "http://ftp.gnu.org/pub/gnu/gettext/gettext-${VERSION}.tar.gz"

printlog "Unpacking gettext"
tar -zxvf "gettext-${VERSION}.tar.gz"

printlog "Configuring gettext"
cd "gettext-${VERSION}"
run_silent "/bin/sh configure"

printlog "Compiling gettext"
make

printlog "Installing gettext"
mkdir -p $INSTALL_DIR/bin
make install DESTDIR=$INSTALL_DIR/bin